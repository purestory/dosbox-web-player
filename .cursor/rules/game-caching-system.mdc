---
description: 
globs: 
alwaysApply: false
---
# ê²Œì„ íŒŒì¼ ìºì‹± ì‹œìŠ¤í…œ ê°€ì´ë“œ

## ğŸš€ **ë¡œì»¬ ìºì‹± ì‹œìŠ¤í…œ ê°œìš”**

### **ìºì‹± ì‹œìŠ¤í…œì˜ ì¥ì **
- **ì´ˆê³ ì† ë¡œë”©**: ë‘ ë²ˆì§¸ ì‹¤í–‰ë¶€í„° ë„¤íŠ¸ì›Œí¬ ì—†ì´ ì¦‰ì‹œ ë¡œë”©
- **ì˜¤í”„ë¼ì¸ ì§€ì›**: ì¸í„°ë„· ì—°ê²° ì—†ì´ë„ ìºì‹œëœ ê²Œì„ ì‹¤í–‰ ê°€ëŠ¥
- **ëŒ€ì—­í­ ì ˆì•½**: í•œ ë²ˆ ë‹¤ìš´ë¡œë“œí•œ ê²Œì„ì€ ì¬ë‹¤ìš´ë¡œë“œ ë¶ˆí•„ìš”
- **ì‚¬ìš©ì ê²½í—˜ í–¥ìƒ**: ë¡œë”© ì‹œê°„ ëŒ€í­ ë‹¨ì¶•

### **ê¸°ìˆ  êµ¬í˜„**
- **IndexedDB**: ë¸Œë¼ìš°ì € ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ í™œìš©
- **ê²Œì„ íŒŒì¼ ì••ì¶•**: ZIP íŒŒì¼ í˜•íƒœë¡œ íš¨ìœ¨ì  ì €ì¥
- **ë©”íƒ€ë°ì´í„° ê´€ë¦¬**: ë²„ì „, í¬ê¸°, ë§ˆì§€ë§‰ ì ‘ê·¼ ì‹œê°„ ì¶”ì 

## ğŸ“ **ìºì‹± ì•„í‚¤í…ì²˜**

### **DOSBox ê²Œì„ ìºì‹± (unchartedwaters2)**
- **íŒŒì¼ ì‹œìŠ¤í…œ**: [unchartedwaters2/src/fs/create-idb-file-system.ts](mdc:unchartedwaters2/src/fs/create-idb-file-system.ts)
- **ê²Œì„ ë¡œë”**: [unchartedwaters2/src/components/Game.tsx](mdc:unchartedwaters2/src/components/Game.tsx)
- **ê²Œì„ íŒŒì¼**: [unchartedwaters2/static/game/](mdc:unchartedwaters2/static/game)

```typescript
// í˜„ì¬ êµ¬í˜„ëœ ìºì‹± ì‹œìŠ¤í…œ
export interface IdbFileSystem {
  delete(key: string): Promise<void>;
  save(key: string, data: Uint8Array): Promise<void>;  
  load(key: string): Promise<Uint8Array | null>;
}
```

### **SNES ê²Œì„ (EmulatorJS)**
- **ê²Œì„ ì„ íƒê¸°**: [frontend/src/components/GameSelector.tsx](mdc:frontend/src/components/GameSelector.tsx)
- **ì—ë®¬ë ˆì´í„°**: [frontend/src/components/EmulatorJS.tsx](mdc:frontend/src/components/EmulatorJS.tsx)
- **ROM íŒŒì¼**: [frontend/public/games/](mdc:frontend/public/games)

## âš¡ **ìºì‹± ìµœì í™” ì „ëµ**

### **1. í˜„ì¬ êµ¬í˜„ëœ ê¸°ëŠ¥**
```typescript
// DOSBox ê²Œì„ ìºì‹± (ê¸°ì¡´ ì½”ë“œ)
const start = useCallback(async () => {
  const db = await createIdbFileSystem(mod, 1);
  const { fs, main } = await createDos(canvas.current!);
  
  // ê²Œì„ íŒŒì¼ ì¶”ì¶œ
  await fs.extract(`/static/game/${gameFile}`);
  
  // ì„¸ì´ë¸Œ íŒŒì¼ ìºì‹±
  const saveFileBody = await db.load(saveFile);
  if (saveFileBody) {
    fs.fs.writeFile(saveFile, saveFileBody);
  }
}, []);
```

### **2. í–¥ìƒëœ ìºì‹± ì‹œìŠ¤í…œ êµ¬í˜„ ë°©ì•ˆ**
```typescript
// ì œì•ˆí•˜ëŠ” í™•ì¥ëœ ìºì‹± ì‹œìŠ¤í…œ
export interface GameCache {
  // ê²Œì„ zip íŒŒì¼ ìºì‹±
  cacheGameFile(gameFile: string, data: Uint8Array): Promise<void>;
  getCachedGameFile(gameFile: string): Promise<Uint8Array | null>;
  
  // ì¶”ì¶œëœ íŒŒì¼ë“¤ ìºì‹±  
  cacheExtractedFiles(gameFile: string, files: Map<string, Uint8Array>): Promise<void>;
  getCachedExtractedFiles(gameFile: string): Promise<Map<string, Uint8Array> | null>;
  
  // ìºì‹œ ìƒíƒœ í™•ì¸
  isGameCached(gameFile: string): Promise<boolean>;
}
```

### **3. ë¡œë”© í”Œë¡œìš° ìµœì í™”**
```typescript
// ë¹ ë¥¸ ë¡œë”©ì„ ìœ„í•œ ìºì‹œ ìš°ì„  ë¡œë”©
const optimizedStart = async () => {
  const gameCache = await createGameCache(mod);
  
  if (await gameCache.isGameCached(gameFile)) {
    // ìºì‹œì—ì„œ ì¦‰ì‹œ ë¡œë“œ
    const cachedFiles = await gameCache.getCachedExtractedFiles(gameFile);
    for (const [fileName, fileData] of cachedFiles) {
      fs.fs.writeFile(fileName, fileData);
    }
    showToast("ğŸ’¨ ìºì‹œì—ì„œ ë¹ ë¥´ê²Œ ë¡œë”©!");
  } else {
    // ì²« ë¡œë”© + ìºì‹±
    await fs.extract(`/static/game/${gameFile}`);
    await cacheExtractedFiles();
    showToast("âœ… ë‹¤ìŒë¶€í„°ëŠ” ë¹ ë¥´ê²Œ ë¡œë”©ë©ë‹ˆë‹¤!");
  }
};
```

## ğŸ® **ê²Œì„ë³„ ìºì‹± ì „ëµ**

### **DOS ê²Œì„ (DOSBox)**
1. **ZIP íŒŒì¼ ë‹¤ìš´ë¡œë“œ** â†’ IndexedDB ì €ì¥
2. **íŒŒì¼ ì¶”ì¶œ** â†’ ê°œë³„ íŒŒì¼ë“¤ë„ ìºì‹±
3. **ì„¸ì´ë¸Œ íŒŒì¼** â†’ ìë™ ë°±ì—…/ë³µì›
4. **ì„¤ì • íŒŒì¼** â†’ ì‚¬ìš©ì ì„¤ì • ë³´ì¡´

### **SNES ê²Œì„ (EmulatorJS)**
1. **ROM íŒŒì¼** â†’ ë¸Œë¼ìš°ì € ìºì‹œ í™œìš©
2. **ì„¸ì´ë¸Œ ìŠ¤í…Œì´íŠ¸** â†’ LocalStorage ì €ì¥
3. **ì„¤ì •** â†’ í‚¤ ë§¤í•‘, í™”ë©´ ì„¤ì • ë“±

## ğŸ”§ **ìºì‹œ ê´€ë¦¬ ê¸°ëŠ¥**

### **1. ìš©ëŸ‰ ê´€ë¦¬**
```typescript
// ìºì‹œ í¬ê¸° ì œí•œ ì˜ˆì‹œ
const MAX_CACHE_SIZE = 500 * 1024 * 1024; // 500MB

async function cleanupCache() {
  const cacheSize = await getCacheSize();
  if (cacheSize > MAX_CACHE_SIZE) {
    // LRU ë°©ì‹ìœ¼ë¡œ ì˜¤ë˜ëœ ê²Œì„ ì‚­ì œ
    await removeOldestGames();
  }
}
```

### **2. ìºì‹œ ìƒíƒœ UI**
- ìºì‹œëœ ê²Œì„ ëª©ë¡ í‘œì‹œ
- ìºì‹œ í¬ê¸° ë° ì‚¬ìš©ëŸ‰ í‘œì‹œ
- ê°œë³„ ê²Œì„ ìºì‹œ ì‚­ì œ ê¸°ëŠ¥
- ì „ì²´ ìºì‹œ ì´ˆê¸°í™” ê¸°ëŠ¥

### **3. ë²„ì „ ê´€ë¦¬**
```typescript
interface CacheMetadata {
  version: string;
  timestamp: number;
  fileSize: number;
  lastAccessed: number;
}
```

## ğŸš¨ **ìºì‹± ì‹œìŠ¤í…œ ì£¼ì˜ì‚¬í•­**

### **ì ˆëŒ€ í•˜ì§€ ë§ ê²ƒ**
1. **ìºì‹œ ë¬´ì‹œí•˜ê³  ë§¤ë²ˆ ë‹¤ìš´ë¡œë“œ**: ë„¤íŠ¸ì›Œí¬ ë‚­ë¹„
2. **ìºì‹œ ê³µê°„ ë¬´ì œí•œ ì‚¬ìš©**: ë¸Œë¼ìš°ì € ì €ì¥ì†Œ ê³ ê°ˆ
3. **ìºì‹œ ê²€ì¦ ì—†ì´ ì‚¬ìš©**: ì†ìƒëœ íŒŒì¼ ë¡œë“œ ìœ„í—˜
4. **ë™ê¸°ì  ìºì‹œ ì‘ì—…**: UI ë¸”ë¡œí‚¹ ë°œìƒ

### **ë°˜ë“œì‹œ í•  ê²ƒ**
1. **ìºì‹œ ìƒíƒœ í™•ì¸**: ë¡œë”© ì „ ìºì‹œ ì—¬ë¶€ ì²´í¬
2. **ì—ëŸ¬ í•¸ë“¤ë§**: ìºì‹œ ì‹¤íŒ¨ ì‹œ ì›ë³¸ ë‹¤ìš´ë¡œë“œ
3. **ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§**: ì •ê¸°ì  ìºì‹œ ì •ë¦¬
4. **ì‚¬ìš©ì ì•Œë¦¼**: ìºì‹œ ìƒíƒœ ì‚¬ìš©ìì—ê²Œ í‘œì‹œ

## ğŸ“Š **ì„±ëŠ¥ ë©”íŠ¸ë¦­**

### **ë¡œë”© ì‹œê°„ ë¹„êµ**
- **ì²« ë¡œë”©**: ë„¤íŠ¸ì›Œí¬ ì†ë„ì— ë”°ë¼ 5-30ì´ˆ
- **ìºì‹œ ë¡œë”©**: 1-3ì´ˆ (90% ì´ìƒ ë‹¨ì¶•)
- **ì„¸ì´ë¸Œ ë¡œë”©**: ì¦‰ì‹œ (< 1ì´ˆ)

### **ì €ì¥ ê³µê°„ íš¨ìœ¨ì„±**
- **ì••ì¶•ë¥ **: ZIP ì••ì¶•ìœ¼ë¡œ 30-50% ê³µê°„ ì ˆì•½
- **ì¤‘ë³µ ì œê±°**: ê³µí†µ íŒŒì¼ ê³µìœ ë¡œ ì¶”ê°€ ì ˆì•½
- **ë©”íƒ€ë°ì´í„°**: ìµœì†Œí•œì˜ ì˜¤ë²„í—¤ë“œ

---

**ğŸ® ê²Œì„ì„ ê¸°ë‹¤ë¦¬ì§€ ì•Šê³  ë°”ë¡œ ì¦ê¸°ëŠ” ìºì‹± ì‹œìŠ¤í…œ**
